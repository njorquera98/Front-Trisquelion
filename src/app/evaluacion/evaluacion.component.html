<!-- Botones para abrir los modales -->
<div class="sticky top-0 z-10 bg-white dark:bg-gray-800 pb-2">
  <h2 class="text-2xl font-semibold text-gray-900 dark:text-white text-center mb-4">
    Última Evaluación del Paciente
  </h2>
  <div class="flex justify-center mt-4 space-x-4">
    <!-- Botón para crear una nueva evaluación -->
    <button (click)="abrirModal('crear')"
      class="flex items-center text-blue-700 hover:text-white border border-blue-700 hover:bg-blue-800 focus:ring-4 focus:outline-none focus:ring-blue-300 font-medium rounded-lg text-sm px-5 py-2.5 dark:border-blue-500 dark:text-blue-500 dark:hover:text-white dark:hover:bg-blue-500 dark:focus:ring-blue-800">
      <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 mr-2" fill="none" viewBox="0 0 24 24"
        stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
          d="M7 19H5a1 1 0 0 1-1-1v-1a3 3 0 0 1 3-3h1m4-6a3 3 0 1 1-6 0 3 3 0 0 1 6 0Zm7.441 1.559a1.907 1.907 0 0 1 0 2.698l-6.069 6.069L10 19l.674-3.372 6.07-6.07a1.907 1.907 0 0 1 2.697 0Z" />
      </svg>
      Agregar Nueva Evaluación
    </button>

    <!-- Botón para ver evaluaciones pasadas -->
    <button *ngIf="evaluacion" (click)="abrirModal('evaluaciones')"
      class="flex items-center text-blue-700 hover:text-white border border-blue-700 hover:bg-blue-800 focus:ring-4 focus:outline-none focus:ring-blue-300 font-medium rounded-lg text-sm px-5 py-2.5 dark:border-blue-500 dark:text-blue-500 dark:hover:text-white dark:hover:bg-blue-500 dark:focus:ring-blue-800">
      <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 mr-2" fill="none" viewBox="0 0 24 24"
        stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
          d="M15 4h3a1 1 0 0 1 1 1v15a1 1 0 0 1-1 1H6a1 1 0 0 1-1-1V5a1 1 0 0 1 1-1h3m0 3h6m-3 5h3m-6 0h.01M12 16h3m-6 0h.01M10 3v4h4V3h-4Z" />
      </svg>
      Ver Evaluaciones Pasadas
    </button>

    <!-- Botón para editar la última evaluación -->
    <button *ngIf="evaluacion" (click)="abrirModal('editar', evaluacion)"
      class="flex items-center text-green-700 hover:text-white border border-green-700 hover:bg-green-800 focus:ring-4 focus:outline-none focus:ring-green-300 font-medium rounded-lg text-sm px-5 py-2.5 dark:border-green-500 dark:text-green-500 dark:hover:text-white dark:hover:bg-green-500 dark:focus:ring-green-800">
      <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 mr-2" fill="none" viewBox="0 0 24 24"
        stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
      </svg>
      Editar Última Evaluación
    </button>

  </div>
</div>

<!-- Mostrar la última evaluación si existe -->
<div *ngIf="evaluacion; else noEvaluacion" class="p-4 space-y-4">
  <div class="p-4 bg-gray-50 dark:bg-gray-700 rounded-lg shadow-md border border-gray-300 dark:border-gray-600">
    <p class="font-semibold text-gray-700 dark:text-gray-300">Fecha de Ingreso</p>
    <p class="text-gray-900 dark:text-white">{{ evaluacion.fechaIngreso | date }}</p>
  </div>
  <div class="p-4 bg-gray-50 dark:bg-gray-700 rounded-lg shadow-md border border-gray-300 dark:border-gray-600">
    <p class="font-semibold text-gray-700 dark:text-gray-300">Objetivo</p>
    <div class="overflow-auto max-h-48">
      <pre class="text-gray-900 dark:text-white whitespace-pre-wrap break-words w-full">{{ evaluacion.objetivo }}</pre>
    </div>
  </div>
  <div class="p-4 bg-gray-50 dark:bg-gray-700 rounded-lg shadow-md border border-gray-300 dark:border-gray-600">
    <p class="font-semibold text-gray-700 dark:text-gray-300">Diagnóstico</p>
    <div class="overflow-auto max-h-48">
      <pre class="text-gray-900 dark:text-white whitespace-pre-wrap break-words w-full">{{ evaluacion.diagnostico }}
      </pre>
    </div>
  </div>
  <div class="p-4 bg-gray-50 dark:bg-gray-700 rounded-lg shadow-md border border-gray-300 dark:border-gray-600">
    <p class="font-semibold text-gray-700 dark:text-gray-300">Anamnesis</p>
    <div class="overflow-auto max-h-48">
      <pre class="text-gray-900 dark:text-white whitespace-pre-wrap break-words w-full">{{ evaluacion.anamnesis }}</pre>
    </div>
  </div>
</div>


<!-- Modal -->
<div *ngIf="mostrarModal" class="fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50">
  <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg w-3/4 md:w-1/2">
    <div class="flex justify-between items-center border-b p-4">
      <h3 class="text-lg font-semibold text-gray-900 dark:text-white">
        {{ modalTipo === 'crear' ? 'Crear Nueva Evaluación' : modalTipo === 'editar' ? 'Editar Evaluación' : 'Ver
        Evaluación' }}
      </h3>
      <button class="text-gray-500 hover:text-gray-700 dark:hover:text-gray-300" (click)="cerrarModal()">
        <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
        </svg>
      </button>
    </div>
    <div class="p-6">
      <ng-container *ngIf="modalTipo === 'crear'; else mostrarEvaluacion">
        <app-crear-evaluacion [pacienteId]="pacienteId" [evaluacion]="ultimaEvaluacion" [modo]="'crear'"
          (evaluacionCreada)="guardarEvaluacion($event)">
        </app-crear-evaluacion>

      </ng-container>

      <ng-template #mostrarEvaluacion>
        <ng-container *ngIf="modalTipo === 'editar'">
          <app-crear-evaluacion [pacienteId]="pacienteId" [evaluacion]="evaluacionSeleccionada" [modo]="'editar'"
            (evaluacionEditada)="guardarEvaluacion($event)" (cerrarModal)="cerrarModal()">
          </app-crear-evaluacion>

        </ng-container>

        <ng-container *ngIf="modalTipo === 'evaluaciones'">
          <app-evaluaciones-pasadas [pacienteId]="pacienteId" [evaluaciones]="evaluacionesPasadas">
          </app-evaluaciones-pasadas>
        </ng-container>
      </ng-template>
    </div>


  </div>
</div>

<ng-template #noEvaluacion>
  <div class="p-4 bg-gray-50 dark:bg-gray-700 rounded-lg">
    <p class="text-gray-900 dark:text-white">No hay evaluaciones disponibles para este paciente.</p>
  </div>
</ng-template>
